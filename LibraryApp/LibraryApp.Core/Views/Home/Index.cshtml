@{
	Layout = null;
}
@model LibraryApp.Data.DTOS.BookDTO;
<!DOCTYPE html>
<html lang="en">

<head>
	<title>Kütüphane Uygulaması</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="author" content="">
	<meta name="keywords" content="">
	<meta name="description" content="">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		  integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

	<link rel="stylesheet" type="text/css" href="css/normalize.css">
	<link rel="stylesheet" type="text/css" href="icomoon/icomoon.css">
	<link rel="stylesheet" type="text/css" href="css/vendor.css">
	<link rel="stylesheet" type="text/css" href="css/style.css?v=13">

</head>

<body data-bs-spy="scroll" data-bs-target="#header" tabindex="0">


	<section id="popular-books" class="bookshelf py-5 my-5">
		<div class="container">
			<div class="row">
				<div class="col-md-12">

					<div class="section-header align-center">
						<div class="title">
						</div>
						<h2 class="section-title">Tüm Kitaplar</h2>
					</div>

					<ul class="tabs">
						@* <li data-tab-target="#all-genre" class="active tab">All Genre</li>
						<li data-tab-target="#business" class="tab">Business</li>
						<li data-tab-target="#technology" class="tab">Technology</li>
						<li data-tab-target="#romantic" class="tab">Romantic</li>
						<li data-tab-target="#adventure" class="tab">Adventure</li>
						<li data-tab-target="#fictional" class="tab">Fictional</li> *@
						<li class="menu-item"><a href="#" class="nav-link btn btn-outline-dark rounded-pill m-0" id="addBookBtn">Kitap Ekle</a></li>

					</ul>

					<div class="tab-content">
						<div id="all-genre" data-tab-content class="active">
							<div class="row">
								@foreach (var book in Model.Books)
								{
									<div class="col-md-3">
										<div class="product-item">
											<figure class="product-style">
												<img src="~/images/@book.Image" alt="Books" class="product-item">
												@if (book.IsBorrowed)
												{
													<button type="button" class="custom-cart">
														<button type="button" class="custom-cart">
															<div>DIŞARDA</div>
															<div>Ödünç alan: @book.BorrowerName</div>
															<div>Dönüş Tarihi: @book.DueDate?.ToShortDateString()</div>
														</button>

													</button>
												}
												else
												{
													<button type="button" onclick="toggleBorrowForm('@book.ID')" class="add-to-cart" data-product-tile="add-to-cart">
														Ödünç ver
													</button>
												}
											</figure>
											<figcaption>
												<h3>@book.Name</h3>
												<span>@book.Author</span>
											</figcaption>
										</div>
										<div class="borrow-form" id="borrowForm_@book.ID" style="display: none;">
											<div style="display: flex; gap: 10px;">
												<input type="text" placeholder="İsim" style="width:150px">
												<input type="date" placeholder="Ödünç tarihi">
											</div>
											<div style="display: flex; gap: 10px;">
												<button type="button" onclick="Borrow('@book.ID')" id="borrowButton" class="nav-link btn btn-outline-success rounded-pill m-0 borrowButton">
													<span class="button-text">Ödünç Ver</span>
												</button>
												<button type="button" id="cancelButton" onclick="cancelForm('@book.ID')" class="nav-link btn btn-outline-danger rounded-pill m-0 cancelButton">
													<span class="button-text">İptal</span>
												</button>
											</div>
										</div>
									</div>
								}
							</div>



						</div>

					</div>


					<!-- Modal -->
					<div class="modal" id="bookModal">
						<div class="modal-dialog">
							<div class="modal-content">
								<!-- Modal Header -->
								<div class="modal-header">
									<h4 class="modal-title">Kitap Ekle</h4>
									<button type="button" id="closeBtn" class="close" data-dismiss="modal">&times;</button>
								</div>

								<!-- Modal Body -->
								<div class="modal-body">
									<form id="bookForm" enctype="multipart/form-data" method="post">
										<div class="form-group">
											<label for="bookName">Kitap Adı:</label>
											<input type="text" class="form-control" id="bookName">
										</div>
										<div class="form-group">
											<label for="author">Yazarı:</label>
											<input type="text" class="form-control" id="author">
										</div>
										<div class="form-group">
											<label for="image">Resim URL:</label>
											<input type="file" accept="image/*" class="form-control" id="image">
										</div>
										<button type="button" class="btn btn-primary" onclick="addBook()">Kaydet</button>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div><!--inner-tabs-->

			</div>
		</div>
	</section>


	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
			crossorigin="anonymous"></script>
	<script src="js/plugins.js"></script>
	<script src="js/script.js?v=2"></script>

</body>

</html>

@* <script>
	function openBorrowForm() {
		var borrowForm = document.querySelector('.borrow-form');
		if (borrowForm) {
			borrowForm.style.display = "block";
		}
	}
</script> *@

<script>
	function toggleBorrowForm(bookId) {
		var borrowForm = document.getElementById('borrowForm_' + bookId);
		if (borrowForm) {
			borrowForm.style.display = borrowForm.style.display === 'none' ? 'block' : 'none';
		}
	}

	function cancelForm(bookID) {
		var borrowForm = document.getElementById('borrowForm_' + bookID);
		borrowForm.style.display = 'none';
	}

	function Borrow(bookID) {
		var borrowerName = document.querySelector('#borrowForm_' + bookID + ' input[type="text"]').value;
		var borrowDate = document.querySelector('#borrowForm_' + bookID + ' input[type="date"]').value;

		var data = {
			ID: bookID,
			BorrowerName: borrowerName,
			BorrowDate: borrowDate
		};

		$.ajax({
			type: "POST",
			url: '/Home/BorrowBook',
			data: JSON.stringify(data),
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (response) {
				alert("Ödünç verme işlemi başarılı");
				window.location.reload();
			},
			error: function (xhr, status, error) {
				alert("Ödünç verme işlemi başarız!");
			}
		});
	}


	document.getElementById('addBookBtn').addEventListener('click', function () {
		$('#bookModal').modal('show');
	});

	document.getElementById('closeBtn').addEventListener('click', function () {
		// Modalı kapatmak için gerekli kod
		// var modal = document.getElementById('bookModal');
		$('#bookModal').modal('hide');
	});

	function addBook() {
		var bookName = document.getElementById('bookName').value;
		var author = document.getElementById('author').value;
		var image = document.getElementById('image');
		var imageFile = image.files[0]; // Bu satırda hata alıyorsanız, image değeri doğru bir şekilde alınamamıştır.

	



		if (bookName == "") {
			alert("Kitap adı boş geçilemez!");
			return false;
		}
		if (author == "") {
			alert("Yazar adı boş geçilemez!");
			return false;
		}
		if (image == "") {
			alert("Resim alanı boş geçilemez!");
			return false;
		}

		var formData = new FormData(); // FormData nesnesi oluşturun
		formData.append("model.Name", bookName); // Kitap adını ekleyin
		formData.append("model.Author", author); // Yazar adını ekleyin
		formData.append("model.Image", imageFile); // Resmi ekleyin

		$.ajax({
			type: "POST",
			url: '@Url.Action("NewBook", "Home")',
			data: formData,
			contentType: false,
			// contentType: "multipart/form-data",
			processData: false,
			// dataType: "json",
			success: function (response) {
				alert("Kitap ekleme işlemi başarılı");
				window.location.reload();
			},
			error: function (xhr, status, error) {
				alert("Kitap ekleme işlemi başarız!");
			}
		});
		// $('#bookModal').modal('hide');
	}
</script>